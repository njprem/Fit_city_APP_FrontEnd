# FitCity Frontend

FitCity is a fully typed Vite + React single-page application that powers both the traveler-facing discovery experience and the back-office tooling used by administrators to curate destinations, approve change requests, and moderate reviews.

## Table of Contents
- [Overview](#overview)
- [Features](#features)
- [Architecture & Tech Stack](#architecture--tech-stack)
- [Requirements](#requirements)
- [Quick Start](#quick-start)
- [Environment Configuration](#environment-configuration)
- [Available Scripts](#available-scripts)
- [Project Structure](#project-structure)
- [Routing Overview](#routing-overview)
- [Key Modules & Data Flow](#key-modules--data-flow)
- [Deployment](#deployment)
- [Development Standards](#development-standards)
- [Troubleshooting & Tips](#troubleshooting--tips)

## Overview
The application is built with React 19, React Router 7, and TypeScript, and ships as a static bundle generated by Vite. The UI follows a utility-first styling approach (Tailwind-style classes) and uses Lucide icons for consistent visuals. All data comes from the FitCity REST API, with an authentication layer that stores sessions in `localStorage` and transparently injects bearer tokens on every request.

## Features
### Traveler Experience
- Marketing landing page (`/`) with entry points into search, authentication, and help flows.
- Authentication stack with log in, sign up, forgotten password, terms, and Google One Tap sign-in integration.
- Search results page with keyword search, category filters, and sort controls backed by `searchDestinations`.
- Destination detail page with hero media, schedules, contact info, geolocation, gallery, ratings, and user-generated reviews (create/delete supported for authenticated users).
- Favorites system with optimistic updates and a cross-tab event bus that keeps `FavoritePage` in sync regardless of where a favorite is added or removed.

### Admin Experience
- `/admin` workspace with a persistent sidebar (`Sidebar.tsx`) that switches between dashboard, destination management, and request-triage views.
- Destination management lists leverage live data from `fetchDestinationChanges`, providing filters (status, type), sort controls, split tabs for published/draft content, and contextual action menus (`ActionMenu.tsx`) for approving, rejecting, editing, or submitting change requests.
- Rich destination form with create/edit/view modes, confirmation flows (`Confirm_Popup.tsx`), and mock data helpers for rapid prototyping.

### Platform & Infrastructure
- Centralized API module (`src/api.ts`) with automatic authorization headers, detailed error logging, and 401 recovery logic that resets the session.
- Configurable base URL and Google Client ID via environment variables with sane fallbacks and console warnings when values are missing.
- Favorites service that can switch between local persistence and real API calls by flipping `USE_SERVER` once backend endpoints are available.
- Production-ready Dockerfile that builds the Vite bundle and serves it through Nginx with an `/api` reverse proxy and large-upload support.

## Architecture & Tech Stack
- **Frameworks:** React 19, React Router 7, Vite 7.
- **Language & Tooling:** TypeScript 5.8, ESLint 9, PostCSS, Tailwind-style utility classes, Lucide React icons, React Select, Recharts.
- **State & Data:** React hooks, service layer abstractions, and type definitions in `src/types`.
- **Build & Deploy:** Vite build pipeline, Docker (Node 22 builder + Nginx runtime), configurable proxying to the FitCity API.

## Requirements
- Node.js 20+ (matching the Docker builder base image).
- npm 10+.
- Access to the FitCity API (or a mocked server) and a Google OAuth client ID if Google sign-in is enabled.

## Quick Start
1. **Install dependencies**
   ```bash
   npm install
   ```
2. **Configure environment variables**  
   Create a `.env` file in the project root:
   ```bash
   VITE_API_URL=http://localhost:8080
   VITE_GOOGLE_CLIENT_ID=YOUR_GOOGLE_CLIENT_ID.apps.googleusercontent.com
   ```
3. **Run the development server**
   ```bash
   npm run dev
   ```
4. Visit http://localhost:5173 (or the port shown in the terminal).

## Environment Configuration
| Variable | Description | Required | Default |
| --- | --- | --- | --- |
| `VITE_API_URL` | Base URL for the FitCity REST API. Used by every service and proxied through Docker. | Yes | `http://localhost:8080` (fallback with console warning) |
| `VITE_GOOGLE_CLIENT_ID` | Google Identity Services client ID for One Tap / OAuth sign-in. | For Google sign-in | empty string (Google buttons disabled) |
| `NGINX_PROXY_PASS` | Docker build arg that sets the upstream target for `/api` and `/swagger` inside Nginx. | Optional | `http://127.0.0.1:8181` |

> Environment variables prefixed with `VITE_` are statically injected at build time. Changes require rebuilding or restarting the dev server.

## Available Scripts
| Script | Description |
| --- | --- |
| `npm run dev` | Starts Vite in development mode with HMR. |
| `npm run build` | Runs TypeScript project references and produces the optimized production build in `dist/`. |
| `npm run preview` | Serves the production bundle locally to verify the build. |
| `npm run lint` | Executes ESLint (TypeScript + React rules). |
| `npm run lint:fix` | Runs ESLint with auto-fix enabled. |

## Project Structure
```
src/
├─ App.tsx                # Application entry + route definitions
├─ components/            # Shared UI (Navbar, Footer, RequireAuth, etc.)
├─ Admin_Pages/
│  ├─ Pages/              # Admin screens (dashboard, destination management, requests)
│  └─ Admin_Component/    # Sidebar, forms, dropdowns, dialogs, action menus
├─ pages/
│  ├─ LandingPage/        # Marketing + auth surface
│  ├─ Traveler/           # Search and destination experiences
│  ├─ Favorite/           # Saved destinations list
│  └─ Help/               # Support content
├─ services/
│  ├─ auth/               # Auth/session helpers, Google client loader, destination service
│  └─ favoritesService.ts # Favorites persistence and eventing
├─ types/                 # Shared TypeScript models (destinations, reviews, etc.)
├─ utils/                 # Utility helpers
└─ config.ts              # Environment-aware configuration
```

## Routing Overview
| Route | Description | Auth |
| --- | --- | --- |
| `/` | Landing page with hero, highlights, and CTA into search/auth. | Public |
| `/login`, `/signup`, `/forgot-password`, `/terms`, `/help`, `/unauthorized` | Authentication and support flows. | Public |
| `/search` | Traveler search results with query, filters, and sort controls. | Public |
| `/destination/:id`, `/destination/slug/:slug` | Destination detail view, gallery, reviews, and favorite controls. | Public (actions gated) |
| `/profile`, `/favorite` | Authenticated traveler utilities guarded by `RequireAuth`. | Requires login |
| `/admin` | Admin workspace (Dashboard, Destination Management, Requests). | Requires login |

## Key Modules & Data Flow
- **Configuration (`src/config.ts`)** – Normalizes `VITE_API_URL` and `VITE_GOOGLE_CLIENT_ID`, providing fallbacks and console warnings during development.
- **API client (`src/api.ts`)** – Wraps fetch calls with automatic bearer token injection, JSON/error handling, logout-on-401, and endpoints for auth, destination change workflows, profile updates, and admin approvals.
- **Authentication services (`src/services/auth`)** – Manage sessions (`authService.ts`), fetch destination/search data (`destinationService.ts`), and lazily load the Google Identity script (`googleClient.ts`).
- **Favorites (`src/services/favoritesService.ts`)** – Provides an event-driven API (`favoritesEvents`) plus add/remove helpers that can switch to server-backed storage once the API is ready.
- **Admin utilities (`src/Admin_Pages/Admin_Component`)** – Shared UI (search bar, dropdowns, confirm dialogs, action menu) and data adapters that map `DestinationChange` payloads into the UI representation used across the admin experience.
- **Routing guard (`src/components/RequireAuth.tsx`)** – Protects profile, favorites, and admin routes by checking for valid tokens and redirecting to `/unauthorized` when needed.

## Deployment
### Production build (static hosting)
1. Build the bundle:
   ```bash
   npm run build
   ```
2. Serve `dist/` behind any static web server or CDN. When not using Docker, ensure your edge/proxy forwards `/api/*` to the FitCity backend and falls back to `index.html` for SPA routing.

### Docker workflow
```bash
docker build \
  --build-arg VITE_API_URL=https://api.example.com \
  --build-arg VITE_GOOGLE_CLIENT_ID=YOUR_CLIENT_ID.apps.googleusercontent.com \
  --build-arg NGINX_PROXY_PASS=http://api:8080 \
  -t fit-city-web .

docker run -d -p 8080:80 --name fit-city fit-city-web
```
- Stage 1 compiles the app using Node 22.
- Stage 2 serves the compiled bundle via Nginx, rewrites SPA routes, increases body limits to 200 MB for gallery uploads, and proxies `/api` + `/swagger` to the upstream specified by `NGINX_PROXY_PASS`.

## Development Standards
- Use TypeScript for all React components and services; prefer strict typing of API contracts located in `src/types`.
- Keep authentication logic inside the service layer; components should call helpers such as `fetchDestinationChanges` or `updateProfile` rather than raw `fetch`.
- Run `npm run lint` before opening a PR to enforce the shared ESLint configuration (`eslint.config.js`).
- UI follows a utility-first approach using Tailwind-style class names; co-locate CSS modules when utility classes are insufficient.
- Keep mock data and adapters (e.g., admin destination mapping) in dedicated helper files to simplify eventual backend integration.

## Troubleshooting & Tips
- Missing or incorrect `VITE_API_URL` / `VITE_GOOGLE_CLIENT_ID` values trigger console warnings from `config.ts`; fix the `.env` file and restart Vite.
- If an API request returns `401`, `fetchWithAuth` automatically logs the user out and redirects to the landing page. Ensure your backend CORS configuration allows the frontend origin.
- Favorites currently fall back to `localStorage`. Set `USE_SERVER = true` inside `src/services/favoritesService.ts` when the `/api/v1/favorites` endpoints are ready.
- Destination search and detail logging is verbose by design to simplify backend debugging. Remove or gate the `[DEBUG]` logs if verbose output is not desired in production builds.
- When enabling Google sign-in in production, ensure the authorized origin matches the deployed domain and that the backend supports `/api/v1/auth/google`.

---
This documentation is intended for day-to-day development as well as onboarding new engineers and DevOps collaborators. If you extend the platform (new routes, services, environment flags, or deployment paths), update this README so it remains the single source of truth.
